/**
*  Ajax Autocomplete-tree for jQuery, version 0.0.1
*  (c) 2014 Ricardo Momm
*
*  Ajax Autocomplete-tree for jQuery is freely distributable under the terms of an MIT-style license.
*  For details, see the web site: https://github.com/ricardomomm/jquery.autocomplete-tree
*/
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports&&"function"==typeof require?require("jquery"):jQuery)}(function(a){"use strict";function b(b,c){var d=function(){},e=this,f={load:null,getValue:function(a){return a.value},getText:function(a){return a.text},getChildCount:function(a){return a.childrenQuantity||0},select:d,cache:!1,debug:!1,canSelectParent:!1,canSelectParentInChildList:!0,showParentInChildList:!0,showBackButton:!0,leftMargin:15,topMargin:5,treeSeparator:" ï¿½ ",maxVisibleItens:5,animationDuration:200,showPathTooltip:!0};e.element=b,e.el=a(b),e.container=null,e.options=a.extend({},f,c),e.console=window.console||d,e.initialize()}var c={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};a.autocompleteTree=b,b.prototype={onKeyPress:function(a){var b=this;switch(a.which){case c.LEFT:case c.RIGHT:case c.UP:case c.DOWN:return void b.navigate(a.which);case c.RETURN:return void b.selectItem();case c.ESC:case c.TAB:b.hideAllItens()}a.stopImmediatePropagation(),a.preventDefault()},debug:function(a){var b=this;if(b.options.debug&&arguments.length>=1){for(var c=1;c<arguments.length;c++)a=a.replace("{"+(c-1)+"}",arguments[c]);b.console.debug(a)}},getItemValue:function(a){var b=this;return b.options.getValue(a)},getItemText:function(a){var b=this;return b.options.getText(a)},getItemChildCount:function(a){var b=this;return b.options.getChildCount(a)},showContainer:function(){var b=this;if(null===b.container){var c=b.el.offset();b.container=a("<div id='act-container' class='act-container'></div>").css({position:"absolute",left:c.left+"px",top:c.top+b.el.outerHeight()+"px",width:b.el.width()+"px"}).appendTo("body").show()}},refreshContainerSize:function(b){var c=this;if(b.children("li").length<=c.options.maxVisibleItens)c.container.css({height:b.outerHeight()+"px",width:c.el.outerWidth()+"px"});else{var d=0;b.children("li").each(function(b,e){b<c.options.maxVisibleItens&&(d+=a(e).outerHeight())}),c.container.css({height:d+"px",width:c.el.outerWidth()+("scroll"==c.el.css("overflow-y")?0:15)+"px","overflow-y":"scroll"})}},ensureItemIsVisibile:function(a){var b=this;b.isHiddenByScroll(a)&&b.container.animate({scrollTop:a.offset().top-b.container.offset().top},"fast")},isHiddenByScroll:function(a){if(null===a)return!1;var b=this,c=b.container.scrollTop(),d=c+b.container.height(),e=a.offset().top-b.container.offset().top,f=e+a.height();return f>d||c>e},showItem:function(a){if(a&&!a.is(":visible")){var b=this;b.container.show();var c=b.selectedItem&&b.selectedItem.length>0?b.selectedItem.offset().left+b.selectedItem.outerWidth():0;a.css({position:"absolute",left:c+"px",top:"0px",width:(b.selectedItem&&b.selectedItem.length>0?b.selectedItem.outerWidth():b.el.outerWidth())+"px"}).show(),b.refreshContainerSize(a),b.visibleItem&&b.visibleItem.length>0&&b.slideLeft(b.visibleItem,a),b.visibleItem=a,b.selectedItem=null,b.isVisible=!0,b.focusNextItem(a)}},hideItem:function(){var b=this;if(b.visibleItem&&0!==b.visibleItem.length&&b.visibleItem.is(":visible")){var c=b.visibleItem;b.selectedItem&&b.selectedItem.toggleClass("act-selected");var d=c.data("parent");d?(b.selectedItem=a("#son-"+d),b.visibleItem=a("#sons-of-"+b.selectedItem.data("parent")),b.refreshContainerSize(b.visibleItem),b.slideRight(c,b.visibleItem)):(b.visibleItem.hide(),b.container.hide(),b.selectedItem=b.visibleItem=null,b.isVisible=!1),b.showPathTooltip()}},slideLeft:function(a,b){var c=this;b.animate({left:"0px"},{duration:c.options.animationDuration,queue:!1}),a.animate({left:-1*a.outerWidth()+"px"},{duration:c.options.animationDuration,queue:!1})},slideRight:function(b,c){var d=this;b.animate({left:b.outerWidth()+"px"},{duration:d.options.animationDuration,queue:!1,complete:function(){a(this).hide()}}),c.animate({left:"0px"},{duration:d.options.animationDuration,queue:!1})},loadItems:function(a){var b=this,c=b.getCachedItems(a);c?b.loadItemsCompleted(a,c):(b.debug("Loading itens sons of {0}",a),b.beginLoadItems(a),b.options.load({term:null,parent:a},function(c){b.endLoadItems(a),b.loadItemsCompleted(a,c)}))},beginLoadItems:function(){},endLoadItems:function(){},loadItemsCompleted:function(a,b){var c=this;if(b){c.options.cache&&c.el.data("sons-of-"+a,b),c.debug("Result: {0}",b.toString());var d=c.createItemsContainer(a,b);c.showItem(d)}else c.debug("No child itens found")},getCachedItems:function(a){var b=this;if(b.options.cache){var c=b.el.data("sons-of-"+a);if(c)return b.debug("Loading itens sons of {0} from cache",a),c}return null},createItemsContainer:function(b,c){var d=this,e=a("#sons-of-"+b);if(0===e.length){if(d.showContainer(),d.debug("Generating {0} container html",b),e=a("<ul id='sons-of-"+b+"' data-parent='"+b+"' class='act-menu' ></ul>").appendTo(a("#act-container")),null!==b){if(d.options.showBackButton){var f=d.createBackButton(b);e.append(f)}if(d.options.showParentInChildList&&d.options.canSelectParentInChildList){var g=a("#son-"+b).data("item"),h=d.createSelectableParentItem(g);e.append(h)}}a.each(c,function(){d.debug("Generating child {0}",this.toString());var a=d.createItem(b,this);e.append(a)})}return e},createBackButton:function(b){var c=this,d=a("<li id='back-"+b+"' data-parent='"+b+"' class='act-back act-unselectable'><span>Voltar</span></li>").click(function(){c.selectItem()}).hover(function(){c.selectedItem&&c.selectedItem.removeClass("act-selected"),c.selectedItem=a(this).addClass("act-selected")},function(){c.selectedItem&&c.selectedItem.removeClass("act-selected"),a(this).removeClass("act-selected"),c.selectedItem=null});return d},createSelectableParentItem:function(b){var c=this,d=c.getItemValue(b),e=a("#son-"+d),f=a("<li id='parent-"+d+"' data-parent='"+e.data("parent")+"' data-val='"+d+"' ><span>"+c.getItemText(b)+"</span></li>");return f.data("item",b).addClass("act-selectableParent").click(function(){c.selectItem()}).hover(function(){c.selectedItem&&c.selectedItem.removeClass("act-selected"),c.selectedItem=a(this).addClass("act-selected")},function(){c.selectedItem&&c.selectedItem.removeClass("act-selected"),a(this).removeClass("act-selected"),c.selectedItem=null}),f},createItem:function(b,c){var d=this,e=d.getItemValue(c),f=a("<li id='son-"+e+"' data-parent='"+b+"'  data-val='"+e+"' ><span>"+d.getItemText(c)+"</span></li>");return f.data("item",c).click(function(){var b=d.getItemChildCount(a(this).data("item"));b>0&&d.options.canSelectParent||0>=b?d.selectItem():b>0&&d.loadItems(a(this).data("val"))}).hover(function(){d.selectedItem&&d.selectedItem.removeClass("act-selected"),d.selectedItem=a(this).addClass("act-selected")},function(){d.selectedItem&&d.selectedItem.removeClass("act-selected"),a(this).removeClass("act-selected"),d.selectedItem=null}),d.getItemChildCount(c)>0&&(f.addClass("act-menu-hasChildren"),d.options.canSelectParent||f.addClass("act-unselectable")),f},focusNextItem:function(a){var b=this,c=a.children("li:first");b.selectedItem&&(b.selectedItem.toggleClass("act-selected"),c=b.selectedItem.next(),0===c.length&&(c=a.children("li:first"))),c.toggleClass("act-selected"),b.selectedItem=c,b.ensureItemIsVisibile(b.selectedItem),b.showPathTooltip()},focusPreviousItem:function(a){var b=this;if(b.selectedItem){b.selectedItem.toggleClass("act-selected");var c=b.selectedItem.prev();0===c.length&&(c=a.children("li:last")),c.toggleClass("act-selected"),b.selectedItem=c,b.ensureItemIsVisibile(b.selectedItem),b.showPathTooltip()}else b.hideItem()},showPathTooltip:function(){var b=this,c=a("#act-pathTooltip");if(0===c.length&&(c=a("<div id='act-pathTooltip' class='act-pathTooltip' style='display:none'><div>"),c.appendTo("body")),c.hide(),c.text(""),b.options.showPathTooltip&&b.selectedItem&&!b.selectedItem.is(".act-back")){var d=b.selectedItem,e="";do e=d.text()+e,e=b.options.treeSeparator+e,d=a("#son-"+d.data("parent"));while(d.length>0);c.text(e),c.show()}},selectItem:function(){var b=this;if(b.isVisible&&b.selectedItem)if(b.selectedItem.is(".act-unselectable"))b.selectedItem.is(".act-menu-hasChildren")?b.loadItems(b.selectedItem.data("val")):b.selectedItem.is(".act-back")&&b.hideItem();else{var c=b.selectedItem.data("item");b.el.val(b.getItemText(c)),b.container.hide(),b.options.showPathTooltip&&a("#act-pathTooltip").hide(),b.isVisible=!1,b.options.select.apply(b.el,[c])}},hideAllItens:function(){for(var a=this;a.isVisible;)a.hideItem()},openChildItens:function(){var a=this;if(a.isVisible&&a.selectedItem&&!a.selectedItem.is(".act-back")){var b=a.selectedItem.data("item");if(a.getItemChildCount(b)>0){var c=a.getItemValue(b);a.loadItems(c)}}},navigate:function(a){var b=this;switch(a){case c.DOWN:var d=b.visibleItem;b.visibleItem?b.isVisible?b.focusNextItem(d):(b.isVisible=!0,b.container.show()):b.loadItems(null);break;case c.UP:b.isVisible&&b.focusPreviousItem(b.visibleItem);break;case c.LEFT:b.hideItem();break;case c.RIGHT:b.openChildItens()}},dispose:function(){var a=this;a.el.off(".autocompletetree").removeData("autocompletetree"),a.container.remove()},initialize:function(){var a=this;a.element.setAttribute("autocomplete","off"),a.el.on("keydown.autocompletetree",function(b){a.onKeyPress(b)}),a.debug("AutoComplete-Tree initialized")}},a.fn.autocompleteTree=function(c,d){var e="autocompletetree";return 0===arguments.length?this.first().data(e):this.each(function(){var f=a(this),g=f.data(e);"string"==typeof c?g&&"function"==typeof g[c]&&g[c](d):(g&&g.dispose&&g.dispose(),g=new b(this,c),f.data(e,g))})}});